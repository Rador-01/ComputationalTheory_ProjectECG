# ECG Scanpath Pattern Recognition Using Hidden Markov Models

[![Python 3.8+](https://img.shields.io/badge/python-3.8+-blue.svg)](https://www.python.org/downloads/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

A computational framework for analyzing medical expertise through eye-tracking scanpath patterns during 12-lead ECG interpretation using Hidden Markov Models.

## ğŸ“‹ Overview

This project applies automata theory concepts to a real-world medical problem: understanding how experts and novices differ in their visual examination of electrocardiograms. By modeling gaze sequences as observations generated by a Hidden Markov Model, we can:

- **Classify** scanpaths as expert or novice patterns
- **Decode** the underlying cognitive diagnostic phases
- **Analyze** systematic vs. erratic viewing strategies
- **Quantify** medical expertise through probabilistic modeling

### Key Innovation: Two-Layer Architecture

Unlike simple Markov chains that directly model lead-to-lead transitions, our HMM framework distinguishes between:

1. **Hidden States**: Cognitive diagnostic phases (e.g., Rhythm-Check, QRS-Analysis)
2. **Observations**: Visible gaze fixations on ECG leads (I, II, III, V1-V6, etc.)

This captures a crucial insight: what we observe through eye-tracking (which lead someone looks at) doesn't directly reveal their cognitive intent. A fixation on Lead II might indicate rhythm analysis, P-wave examination, or general scanningâ€”the mapping is probabilistic and context-dependent.

## ğŸ—ï¸ Architecture

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚          HIDDEN MARKOV MODEL                â”‚
                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚                                             â”‚
   Hidden States    â”‚  Rhythm â†’ Axis â†’ P-wave â†’ PR â†’ QRS â†’ ...   â”‚
   (Cognitive       â”‚    â†“        â†“       â†“      â†“     â†“         â”‚
    Phases)         â”‚   A[i,j] = P(state_j | state_i)            â”‚
                    â”‚                                             â”‚
                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚                                             â”‚
   Observations     â”‚     II    I,aVF   II,V1   II    V1-V6      â”‚
   (ECG Leads)      â”‚   B[j,k] = P(lead_k | state_j)             â”‚
                    â”‚                                             â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ Quick Start

### Installation

```bash
# Clone the repository
git clone https://github.com/yourusername/ecg-scanpath-hmm.git
cd ecg-scanpath-hmm

# Install dependencies (only NumPy required)
pip install numpy
```

### Run the Full Pipeline

```bash
cd src
python main.py
```

This will:
1. Generate synthetic expert and novice scanpath data
2. Train separate HMMs for each expertise level
3. Evaluate classification performance
4. Analyze learned parameters
5. Output detailed results

### Example Output

```
Classification Results:
  - Accuracy:    92.0%
  - Precision:   89.4%
  - Recall:      95.5%
  - F1-Score:    92.4%
  - Specificity: 88.5%

Performance:
  - Training time: 0.034s
  - Classification: 0.34 ms/sample
```

## ğŸ“ Project Structure

```
ecg-scanpath-hmm/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ __init__.py           # Package initialization
â”‚   â”œâ”€â”€ hmm.py                # Core HMM implementation
â”‚   â”œâ”€â”€ data_generator.py     # Synthetic data generation
â”‚   â”œâ”€â”€ evaluation.py         # Metrics and analysis
â”‚   â””â”€â”€ main.py               # Main execution script
â”œâ”€â”€ data/                     # Generated datasets
â”œâ”€â”€ results/                  # Evaluation results
â”œâ”€â”€ docs/                     # Documentation
â”œâ”€â”€ examples/                 # Usage examples
â””â”€â”€ README.md
```

## ğŸ“Š Model Definition

### Formal HMM Specification

The model is defined as a 5-tuple: **Î» = (S, O, A, B, Ï€)**

| Symbol | Description | Size |
|--------|-------------|------|
| **S** | Hidden states (diagnostic phases) | N = 9 |
| **O** | Observations (ECG leads) | M = 12 |
| **A** | Transition probability matrix | N Ã— N |
| **B** | Emission probability matrix | N Ã— M |
| **Ï€** | Initial state distribution | N Ã— 1 |

### Hidden States (Diagnostic Phases)

Following AHA/ACCF ECG interpretation guidelines:

1. `Rhythm-Check` - Assess heart rate and rhythm regularity
2. `Axis-Determination` - Calculate electrical axis
3. `P-wave-Analysis` - Examine atrial activity
4. `PR-interval-Assessment` - Check AV conduction
5. `QRS-Analysis` - Evaluate ventricular depolarization
6. `ST-segment-Evaluation` - Identify ischemic changes
7. `T-wave-Examination` - Assess ventricular repolarization
8. `QT-interval-Measurement` - Measure total electrical systole
9. `Lead-by-Lead-Review` - Systematic final review

### Observations (ECG Leads)

Standard 12-lead ECG: `I, II, III, aVR, aVL, aVF, V1, V2, V3, V4, V5, V6`

## ğŸ”§ Core Algorithms

### Forward Algorithm

Computes P(O|Î») - the likelihood of an observation sequence:

```python
from src.hmm import HiddenMarkovModel

hmm = HiddenMarkovModel()
# ... train the model ...

# Compute likelihood
observations = ['II', 'V1', 'I', 'aVF', 'V1', 'V2', 'V3']
alpha, log_likelihood = hmm.forward(observations, use_log=True)
print(f"Log-likelihood: {log_likelihood:.4f}")
```

**Complexity**: O(NÂ² Â· T) time, O(N Â· T) space

### Viterbi Algorithm

Finds the most likely hidden state sequence:

```python
# Decode cognitive states
best_path, best_prob = hmm.viterbi(observations)
print(f"Decoded states: {best_path}")
# Output: ['Rhythm-Check', 'Rhythm-Check', 'Axis-Determination', ...]
```

**Complexity**: O(NÂ² Â· T) time, O(N Â· T) space

### Classification

```python
from src.hmm import ScanpathClassifier

classifier = ScanpathClassifier()
classifier.train(expert_data, novice_data)

# Classify new scanpath
prediction, expert_ll, novice_ll = classifier.classify(observations)
print(f"Prediction: {prediction}")  # 'EXPERT' or 'NOVICE'
```

## ğŸ“ˆ Evaluation Metrics

| Metric | Formula | Description |
|--------|---------|-------------|
| Accuracy | (TP + TN) / Total | Overall correctness |
| Precision | TP / (TP + FP) | Expert prediction reliability |
| Recall | TP / (TP + FN) | Expert detection rate |
| F1-Score | 2Â·PÂ·R / (P + R) | Harmonic mean of P and R |
| Specificity | TN / (TN + FP) | Novice detection rate |

## ğŸ§ª Synthetic Data Generation

Our data generator creates clinically-grounded scanpaths based on AHA/ACCF guidelines:

### Expert Patterns
- Systematic workflow (Rhythm â†’ Axis â†’ P-wave â†’ ...)
- Efficient coverage of diagnostic regions
- Focused fixations on relevant leads
- Mean length: ~22 fixations

### Novice Patterns
- Erratic, non-systematic viewing
- High backtracking and redundancy
- Scattered fixation distribution
- Mean length: ~18 fixations

```python
from src.data_generator import ScanpathDatasetGenerator

generator = ScanpathDatasetGenerator(seed=42)
samples = generator.generate_dataset(n_expert=100, n_novice=100)

# Save to files
generator.save_dataset(samples, 'data/', format='both')
```

## ğŸ“š References

1. Surawicz, B. et al. (2009). AHA/ACCF/HRS recommendations for the standardization and interpretation of the electrocardiogram. *JACC*, 53(11), 982-991.

2. Rabiner, L. R. (1989). A tutorial on hidden Markov models and selected applications in speech recognition. *Proceedings of the IEEE*, 77(2), 257-286.

3. Krupinski, E. A. (2006). Visual search of mammographic images. *Academic Radiology*, 12(8), 965-969.

## ğŸ‘¥ Authors

- **Riad Benbrahim** - [riad.benbrahim@um6p.ma](mailto:riad.benbrahim@um6p.ma)
- **Mohamed Amine El Bacha** - [mohamedamine.elbacha@um6p.ma](mailto:mohamedamine.elbacha@um6p.ma)
- **Youssef Kaya** - [youssef.kaya@um6p.ma](mailto:youssef.kaya@um6p.ma)

## ğŸ“ Course Information

**Computational Theory - Fall 2025**  
Mohammed VI Polytechnic University  
UM6P College of Computing, Rabat Campus

## ğŸ“„ License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## ğŸ™ Acknowledgments

- We acknowledge the use of Claude (Anthropic) for assistance with code generation and documentation
- Course instructor for project guidance and feedback
- AHA/ACCF for ECG interpretation guidelines that informed our clinical grounding

---

*This project demonstrates how theoretical computer science concepts (Hidden Markov Models, automata theory) can be applied to solve real-world problems in medical image interpretation and cognitive science.*
